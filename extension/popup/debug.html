<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AISC Debug Logs</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 { font-size: 18px; }
    .controls { margin-bottom: 20px; }
    button {
      padding: 8px 16px;
      margin-right: 10px;
      cursor: pointer;
    }
    .log-entry {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    .log-entry.error { border-color: #f00; background: #fee; }
    .log-entry.warn { border-color: #f90; background: #ffd; }
    .log-entry.info { border-color: #09f; background: #eef; }
    .timestamp { color: #666; font-size: 12px; }
    .source { font-weight: bold; }
    .message { margin: 8px 0; }
    .data {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      font-size: 12px;
      max-height: 200px;
      overflow: auto;
    }
    #logs { margin-top: 20px; }
    .empty { color: #999; font-style: italic; }
  </style>
</head>
<body>
  <h1>AI Shopping Copilot - Debug Logs</h1>

  <div class="controls">
    <button id="refresh">Refresh Logs</button>
    <button id="clear">Clear Logs</button>
    <button id="copy">Copy to Clipboard</button>
  </div>

  <div id="logs">
    <p class="empty">Loading logs...</p>
  </div>

  <script>
    const DEBUG_LOG_KEY = 'aisc_debug_logs';
    const logsContainer = document.getElementById('logs');

    async function loadLogs() {
      try {
        const result = await chrome.storage.local.get(DEBUG_LOG_KEY);
        const logs = result[DEBUG_LOG_KEY] || [];

        if (logs.length === 0) {
          logsContainer.innerHTML = '<p class="empty">No logs yet. Click the merge button in the extension popup to generate logs.</p>';
          return;
        }

        // Show newest first
        const reversedLogs = [...logs].reverse();

        logsContainer.innerHTML = reversedLogs.map(log => `
          <div class="log-entry ${log.level}">
            <div class="timestamp">${log.timestamp}</div>
            <div class="source">[${log.level.toUpperCase()}] ${log.source}</div>
            <div class="message">${escapeHtml(log.message)}</div>
            ${log.data ? `<div class="data">${escapeHtml(log.data)}</div>` : ''}
          </div>
        `).join('');
      } catch (err) {
        logsContainer.innerHTML = `<p class="empty">Error loading logs: ${err.message}</p>`;
      }
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    document.getElementById('refresh').addEventListener('click', loadLogs);

    document.getElementById('clear').addEventListener('click', async () => {
      await chrome.storage.local.remove(DEBUG_LOG_KEY);
      loadLogs();
    });

    document.getElementById('copy').addEventListener('click', async () => {
      const result = await chrome.storage.local.get(DEBUG_LOG_KEY);
      const logs = result[DEBUG_LOG_KEY] || [];
      await navigator.clipboard.writeText(JSON.stringify(logs, null, 2));
      alert('Logs copied to clipboard!');
    });

    // Load on start
    loadLogs();

    // Auto-refresh every 2 seconds
    setInterval(loadLogs, 2000);
  </script>
</body>
</html>
